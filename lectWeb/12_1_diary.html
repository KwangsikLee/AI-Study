<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>LocalStorage 달력 일기장</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif; }
        .container { display: flex; max-width: 800px; margin: 20px auto; gap: 20px; }
        .calendar-container { width: 400px; }
        .diary-container { flex-grow: 1; }
        
        /* 달력 스타일 */
        .calendar-header { display: flex; justify-content: space-between; align-items: center; }
        #month-year { font-size: 1.5em; font-weight: bold; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; }
        .day, .date { padding: 10px; }
        .day { font-weight: bold; }
        .date { cursor: pointer; position: relative; }
        .date.other-month { color: #ccc; }
        .date.today { background-color: #ffc107; border-radius: 50%; }
        .date.selected { background-color: #007bff; color: white; border-radius: 50%; }
        .date .has-entry { width: 5px; height: 5px; background-color: #007bff; border-radius: 50%; position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); }

        /* 일기장 스타일 */
        textarea { width: 100%; height: 200px; box-sizing: border-box; margin-bottom: 10px; }
        .buttons button { padding: 10px; cursor: pointer; }
        #save-btn { background: #28a745; color: white; border: none; }
        #delete-btn { background: #dc3545; color: white; border: none; }
        #selected-date-display { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="calendar-container">
            <div class="calendar-header">
                <button id="prev-month">&lt;</button>
                <h2 id="month-year"></h2>
                <button id="next-month">&gt;</button>
            </div>
            <div class="calendar-grid" id="days">
                <div class="day">일</div><div class="day">월</div><div class="day">화</div>
                <div class="day">수</div><div class="day">목</div><div class="day">금</div><div class="day">토</div>
            </div>
            <div class="calendar-grid" id="dates"></div>
        </div>
        <div class="diary-container">
            <h1>나의 일기장</h1>
            <div id="selected-date-display">날짜를 선택하세요</div>
            <textarea id="diary-input" placeholder="오늘의 하루를 기록해보세요..."></textarea>
            <div class="buttons">
                <button id="save-btn">저장 / 수정</button>
                <button id="delete-btn">삭제</button>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'diaries';
        let currentDate = new Date();
        let selectedDate = null;

        // --- DOM 요소 가져오기 ---
        const monthYearEl = document.getElementById('month-year');
        const datesEl = document.getElementById('dates');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const selectedDateDisplay = document.getElementById('selected-date-display');
        const diaryInput = document.getElementById('diary-input');
        const saveBtn = document.getElementById('save-btn');
        const deleteBtn = document.getElementById('delete-btn');

        // --- API 모듈 시뮬레이션 (LocalStorage) ---
        const diaryApi = {
            // GET /diaries
            getDiaries: function() {
                const diaries = localStorage.getItem(STORAGE_KEY);
                return diaries ? JSON.parse(diaries) : {};
            },
            // GET /diaries/:dateKey
            getDiaryByDate: function(dateKey) {
                const diaries = this.getDiaries();
                return diaries[dateKey] || null;
            },
            // POST & PUT /diaries/:dateKey
            saveDiary: function(dateKey, content) {
                const diaries = this.getDiaries();
                diaries[dateKey] = content;
                localStorage.setItem(STORAGE_KEY, JSON.stringify(diaries));
            },
            // DELETE /diaries/:dateKey
            deleteDiary: function(dateKey) {
                const diaries = this.getDiaries();
                delete diaries[dateKey];
                localStorage.setItem(STORAGE_KEY, JSON.stringify(diaries));
            }
        };

        // --- 달력 렌더링 로직 ---
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            monthYearEl.textContent = `${year}년 ${month + 1}월`;
            datesEl.innerHTML = '';
            
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const allDiaries = diaryApi.getDiaries();

            for (let i = 0; i < firstDay; i++) {
                datesEl.innerHTML += `<div class="date other-month"></div>`;
            }

            for (let i = 1; i <= lastDate; i++) {
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                const dateDiv = document.createElement('div');
                dateDiv.className = 'date';
                dateDiv.textContent = i;
                dateDiv.dataset.key = dateKey;

                if (new Date().toDateString() === new Date(year, month, i).toDateString()) {
                    dateDiv.classList.add('today');
                }
                
                if (allDiaries[dateKey]) {
                    dateDiv.innerHTML += `<span class="has-entry"></span>`;
                }
                
                datesEl.appendChild(dateDiv);
            }
        }

        // --- 날짜 선택 및 일기 로드 로직 ---
        datesEl.addEventListener('click', (e) => {
            if (e.target.classList.contains('date') && e.target.dataset.key) {
                selectedDate = e.target.dataset.key;

                // 모든 .selected 클래스 제거 후 현재 타겟에만 추가
                document.querySelectorAll('.date.selected').forEach(d => d.classList.remove('selected'));
                e.target.classList.add('selected');

                selectedDateDisplay.textContent = selectedDate;
                const diaryContent = diaryApi.getDiaryByDate(selectedDate);
                diaryInput.value = diaryContent || '';
            }
        });

        // --- 이벤트 리스너 ---
        prevMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        saveBtn.addEventListener('click', () => {
            if (!selectedDate) {
                alert('먼저 달력에서 날짜를 선택해주세요.');
                return;
            }
            if (diaryInput.value.trim() === '') {
                alert('내용을 입력해주세요.');
                return;
            }
            diaryApi.saveDiary(selectedDate, diaryInput.value);
            alert('일기가 저장되었습니다.');
            renderCalendar(); // 일기 작성 표시 업데이트
        });
        
        deleteBtn.addEventListener('click', () => {
            if (!selectedDate) {
                alert('먼저 달력에서 날짜를 선택해주세요.');
                return;
            }
            if (confirm(`${selectedDate}의 일기를 정말 삭제하시겠습니까?`)) {
                diaryApi.deleteDiary(selectedDate);
                diaryInput.value = '';
                alert('일기가 삭제되었습니다.');
                renderCalendar(); // 일기 작성 표시 업데이트
            }
        });

        // --- 초기 실행 ---
        renderCalendar();
    </script>
</body>
</html>